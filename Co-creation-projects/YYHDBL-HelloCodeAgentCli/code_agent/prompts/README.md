# Prompts

本目录用于集中管理 Code Agent 的提示词，方便独立迭代与对比。

## 文件说明
- `system.md`：全局行为与安全边界（按需探索/敏感操作确认/补丁格式）
- `react.md`：ReAct 回合格式与工具输入约定
- `plan.md`：规划工具（`plan[...]`）专用提示词
- `summarize_observation.md`：工具输出摘要提示词

## 核心设计理念（类似 Claude Code）

### 按需探索
- **保底上下文**（自动注入）：系统提示 + 对话历史[-10:] + 上次工具摘要[-3:]
- **扩展上下文**（按需获取）：通过 `context_fetch` 工具由模型主动调用

### context_fetch 工具使用指南

**何时使用：**
- ✅ 需要搜索代码中的类/函数定义
- ✅ 用户问"有没有关于 X 的笔记/记忆"
- ✅ 提到错误栈/报错信息，需要找相关代码
- ❌ 用户问"我们刚才说了什么"（直接用对话历史）
- ❌ 已经通过 terminal 拿到足够证据

**参数说明：**
```json
{
  "sources": ["files", "notes", "memory", "tests"],  // 可多选
  "query": "ContextBuilder",                         // 关键词
  "paths": "context/**/*.py"                         // 可选，限定范围
}
```

**预算控制：** 每个数据源返回最多 ~800 tokens，自动截断，支持缓存

**调用策略：** 先用保底上下文推理，证据不足再调用；避免盲目全局扫描

